<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
    <id>TapatalkSMFPlugin:TapatalkDevelopmentTeam</id>
    <file name="$sourcedir/Load.php">
        <operation>
            <search position="after"><![CDATA[	$context['menu_separator'] = !empty($settings['use_image_buttons']) ? ' ' : ' | ';]]></search>
            <add><![CDATA[	include('mobiquo/smartbanner.php');]]></add>
        </operation>
    </file>
        <file name="$sourcedir/Post.php">
        <operation>
            <search position="replace"><![CDATA[			// Only send it to everyone if the topic is approved, otherwise just to the topic starter if they want it.
			if ($topic_info['approved'])
				sendNotifications($topic, 'reply');]]></search>
            <add><![CDATA[			// Only send it to everyone if the topic is approved, otherwise just to the topic starter if they want it.
			if ($topic_info['approved'])
			{
				sendNotifications($topic, 'reply');
				global $boarddir;
				if (function_exists('tapatalk_push_reply'))
					tapatalk_push_reply($msgOptions['id']);
				else if(file_exists($boarddir . '/mobiquo/push_hook.php'))
				{
					include($boarddir . '/mobiquo/push_hook.php');
					tapatalk_push_reply($msgOptions['id']);
				}
			}]]></add>
        </operation>
        <operation>
            <search position="replace"><![CDATA[			notifyMembersBoard($notifyData);]]></search>
            <add><![CDATA[			notifyMembersBoard($notifyData);
			global $boarddir;
			if (function_exists('tapatalk_push_quote_tag'))
				tapatalk_push_quote_tag($msgOptions['id'], true);
			else if(file_exists($boarddir . '/mobiquo/push_hook.php'))
			{
				include($boarddir . '/mobiquo/push_hook.php');
				tapatalk_push_quote_tag($msgOptions['id'], true);
			}]]></add>
        </operation>
    </file>
        <file name="$sourcedir/PersonalMessage.php">
        <operation>
            <search position="replace"><![CDATA[	// Message sent successfully?
	if (!empty($context['send_log']) && empty($context['send_log']['failed']))
		$context['current_label_redirect'] = $context['current_label_redirect'] . ';done=sent';]]></search>
            <add><![CDATA[	// Message sent successfully?
	if (!empty($context['send_log']) && empty($context['send_log']['failed']))
	{
		$context['current_label_redirect'] = $context['current_label_redirect'] . ';done=sent';
		global $boarddir;
		if (function_exists('tapatalk_push_pm'))
		tapatalk_push_pm();
		else if(file_exists($boarddir . '/mobiquo/push_hook.php'))
		{
			include($boarddir . '/mobiquo/push_hook.php');
			tapatalk_push_pm();
		}
	}]]></add>
        </operation>
    </file>
        </file>

        <file name="$themedir/languages/Admin.english.php">
        <operation>
            <search position="after"><![CDATA[?>]]></search>
            <add><![CDATA[//Tapatalk
$txt['tapatalktitle'] = 'Tapatalk Settings';
$txt['tp_general_settings'] = 'General';
$txt['tp_other_settings'] = 'Others';
$txt['tp_board_settings'] = 'Boards';
$txt['tp_rebranding_settings'] = 'Rebranding Settings';]]></add>
        </operation>
        </file>
        <file name="$themedir/languages/ManageSettings.english.php">
        <operation>
            <search position="after"><![CDATA[?>]]></search>
            <add><![CDATA[//Tapatalk
$txt['tapatalktitle'] = 'Tapatalk Settings';
$txt['tp_pushEnabled'] = 'Enable Tapatalk Push Notification';
$txt['tapatalkEnabled'] = 'Enable tapatalk';
$txt['tp_guestOkayEnabled'] = 'Enable forum view for guest by tapatalk';
$txt['tp_tapatalkRegisterEnabled'] = 'In-app Registration';
$txt['tp_ipad_msg'] = 'iPad Product Message';
$txt['tp_ipad_url'] = 'iPad Product URL';
$txt['tp_iphone_msg'] = 'iPhone Product Message';
$txt['tp_iphone_url'] = 'iPhone Product URL';
$txt['tp_android_msg'] = 'Android Product Message';
$txt['tp_android_url'] = 'Android Product URL';
$txt['tp_android_hd_msg'] = 'Android  (Tablet) Product Message';
$txt['tp_android_hd_url'] = 'Android  (Tablet) Product URL';
$txt['tp_kf_msg'] = 'Kindle Fire Product Message';
$txt['tp_kf_url'] = 'Kindle Fire Product URL';
$txt['tp_kf_hd_msg'] = 'Kindle Fire HD Product Message';
$txt['tp_kf_hd_url'] = 'Kindle Fire HD Product URL';
$txt['tp_allow_usergroup'] = 'Usergroup allowed on Tapatalk';
$txt['tp_general_settings'] = 'General';
$txt['tp_board_settings'] = 'Boards';
$txt['tp_rebranding_settings'] = 'Build Your Own';
$txt['tp_other_settings'] = 'Help';
$txt['tp_parent_board'] = 'Boards1';
$txt['tp_child_board'] = 'Boards2';
$txt['tp_board_settingsDesc'] = 'Settings related to boards';
$txt['tp_general_settingsDesc'] = 'These are general settings for tapatalk';
$txt['tp_other_settingsDesc'] = 'Taptalk information';
$txt['tp_rebranding_settingsDesc'] = 'Settings for users who have built their own mobile forum application, try build your <a href="http://tapatalk.com/build.php"> <u>own application</u></a>?';
$txt['tp_select_boards'] = 'Select Boards to HIDE on Tapatalk';
$txt['tp_disable_newtopic'] = 'Disable New Topic For Boards';
$txt['tp_register_page_url'] = 'Register page url';
$txt['tp_push_key'] = 'Push Notification Key';
$txt['tp_byo_app_id'] = 'BYO App ID';
$txt['tp_byo_app_name'] = 'BYO App Name';
$txt['tp_byo_app_desc'] = 'BYO App Description';
$txt['tp_byo_app_icon_url'] = 'BYO App Icon URL';
$txt['tp_custom_content_replacement'] = 'Thread Content Replacement(Advanced)';
$txt['taptalk_descp'] = '<strong>Tapatalk for SMF Plugin</strong></br><br>
For SMF 2.0 RC5/Final, <a href = "http://www.tapatalk.com">http://www.tapatalk.com</a></br>
For more remote settings, please check <a style="color:red;" href = "http://tapatalk.com/landing.php"><u>here</u></a>.<br><br>
<b>What is Tapatalk?</b></br>
Tapatalk is a forum app for iPhone/iPad, Android, BlackBerry, Windows Phone and WebOS. The app provides super fast forum access to any vBulletin, IPBoard, phpBB, SMF, xenForo, MyBB and Kunena forums that have activated Tapatalk. Forum owner can download the free plug-in to activate Tapatalk in your forum.</br>

<b>What does this mod do?</b></br>
This mod enables your forum to be accessed by the Tapatalk app. The Tapatalk app can be downloaded from Apple iTune Store or from Google Android Market.</br>

<b>What next do I have to do?</b></br>
After installing this mod, head straight to <a href = "http://tapatalk.com/activate_tapatalk.php">http://tapatalk.com/activate_tapatalk.php</a> and register there. After registering you can enlist your forum into the Tapatalk network.</br>
</br>
Please manually change permission of all files under mobiquo/ folder (including the folder itself) to chmod 755 otherwise it won\'t work!!</br>
</br>
For more information please visit tapatalk.com</br>
<br>
Thank you! :)';]]></add>
        </operation>
        </file>

        <file name="$themedir/languages/Help.english.php">
        <operation>
            <search position="after"><![CDATA[?>]]></search>
            <add><![CDATA[//Tapatalk start
$helptxt['tapatalkEnabled'] = 'Enable tapatalk for your forum.';
$helptxt['tp_pushEnabled'] = 'Allows user to receive mobile Push Notification from your forum.';
$helptxt['tp_guestOkayEnabled'] = 'Allow non-registered users to access your forum via Tapatalk.';
$helptxt['tp_tapatalkRegisterEnabled'] = 'Allows Tapatalk users to create new account, change password and update email address in-app.';
$helptxt['tp_register_page_url'] = 'Registration URL relative to your forum root path';
$helptxt['tp_push_key'] = 'Optional. To improve the quality of Push Notification from your forum, please fill-in copy and paste the Push Notification Key from Tapatalk Forum Owner Area to here.';
$helptxt['tp_ipad_msg'] = 'Customize this message if you are Tapatalk Rebranding Customer and has published your App to Apple App Store. Default: "This forum has an app for iPad! Click OK to learn more about Tapatalk."';
$helptxt['tp_ipad_url'] = 'Change this URL if you are Tapatalk Rebranding Customer and has obtained your App URL from Apple App Store. Default: http://itunes.apple.com/us/app/tapatalk-hd-for-ipad/id481579541?mt=8';
$helptxt['tp_iphone_msg'] = 'Customize this message if you are Tapatalk Rebranding Customer and has published your App to Apple App Store. Default: "This forum has an app for iPhone and iPod Touch! Click OK to learn more about Tapatalk."';
$helptxt['tp_iphone_url'] = 'Change this URL if you are Tapatalk Rebranding Customer and has obtained your App URL from Apple App Store. Default: http://itunes.apple.com/us/app/tapatalk-forum-app/id307880732?mt=8';
$helptxt['tp_android_msg'] = 'Customize this message if you are Tapatalk Rebranding Customer and has published your App to Google Play. Default: "This forum has an app for Android. Click OK to learn more about Tapatalk."';
$helptxt['tp_android_url'] = 'Change this URL if you are Tapatalk Rebranding Customer and has obtained your App URL from Google Play. Default: market://details?id=com.quoord.tapatalkpro.activity';
$helptxt['tp_android_hd_msg'] = 'Customize this message if you are Tapatalk Rebranding Customer and has published your App to Google Play. Default: "This forum has an app for Android. Click OK to learn more about Tapatalk."';
$helptxt['tp_android_hd_url'] = 'Change this URL if you are Tapatalk Rebranding Customer and has obtained your App URL from Google Play. Default: market://details?id=com.quoord.tapatalkHD';
$helptxt['tp_kf_msg'] = 'Customize this message if you are Tapatalk Rebranding Customer and has published your App to Amazon App Store. Default: "This forum has an app for Kindle Fire! Click OK to learn more about Tapatalk."';
$helptxt['tp_kf_url'] = 'Change this URL if you are Tapatalk Rebranding Customer and has obtained your App URL from Amazon App Store. Default: http://www.amazon.com/gp/mas/dl/android?p=com.quoord.tapatalkpro.activity';
$helptxt['tp_kf_hd_msg'] = 'Customize this message if you are Tapatalk Rebranding Customer and has published your App to Amazon App Store. Default: "This forum has an app for Kindle Fire! Click OK to learn more about Tapatalk."';
$helptxt['tp_kf_hd_url'] = 'Change this URL if you are Tapatalk Rebranding Customer and has obtained your App URL from Amazon App Store. Default: http://www.amazon.com/gp/mas/dl/android?p=com.quoord.tapatalkHD';
$helptxt['tp_allow_usergroup'] = 'Allow usergroups to login via Tapatalk, leave this option empty means that all usergroups users can login via Tapatalk. Different usergroups should be departed by comma, for example, "3,11,6" which means only users who belongs to 3,6 and 11 usergroups can login via Tapatalk.';
$helptxt['tp_hide_boards'] = 'Hide forums you don\'t want them to be listed in Tapatalk app.';
$helptxt['tp_dsa_boards'] = 'Prevent Tapatalk users to create new topic in the selected sub-forums. This feature is useful if certain forums requires additional topic fields or permission that Tapatalk does not support.';
$helptxt['tp_custom_content_replacement'] = 'Ability to match and replace thread content using PHP preg_replace function(http://www.php.net/manual/en/function.preg-replace.php). E.g. "\'pattern\', \'replacement\'" . You can define more than one replace rule on each line.';
$helptxt['tp_byo_app_id'] = 'Enter your product ID in Apple App Store, to be used on iPhone device';
$helptxt['tp_byo_app_name'] = 'Please limit this name to within 20 characters';
$helptxt['tp_byo_app_desc'] = 'A short description of the product, ideally within five words. Less is better for small screen';
$helptxt['tp_byo_app_icon_url'] = 'Icon URL to be loaded and displayed on Smart App Banner';
//Tapatalk ends
]]></add>
        </operation>
        </file>

        <file name="$themedir/languages/Who.english.php">
        <operation>
            <search position="after"><![CDATA[?>]]></search>
            <add><![CDATA[$txt['on_tapatalk'] = 'On Tapatalk';]]></add>
        </operation>
        </file>

        <file name="$sourcedir/ModerationCenter.php">
        <operation>
            <search position="before"><![CDATA[			'time_started' => timeformat($row['time_started']),
			'last_updated' => timeformat($row['time_updated']),]]></search>
            <add><![CDATA[			'timestamp_started' => $row['time_started'],]]></add>
        </operation>
        </file>
        <file name="$themedir/Who.template.php">
        <operation>
            <search position="replace"><![CDATA[global $context, $settings, $options, $scripturl, $txt;]]></search>
            <add><![CDATA[global $context, $settings, $options, $scripturl, $txt, $boardurl;]]></add>
        </operation>
        <operation>
            <search position="replace"><![CDATA[<span class="contact_info floatright">]]></search>
            <add><![CDATA[<span class="contact_info floatright">'.((strpos($member['query']['USER_AGENT'], 'Tapatalk') !== false)? '<a title='.$txt['on_tapatalk'].' href="http://tapatalk.com">
<img align="bottom" alt="Online" src="'.$boardurl.'/mobiquo/forum_icons/tapatalk-online.png">
</a>' : '').']]></add>
        </operation>
        </file>
        <file name="$themedir/Admin.template.php">
        <operation>
            <search position="replace"><![CDATA[					echo '
							<textarea rows="', ($config_var['size'] ? $config_var['size'] : 4), '" cols="30" ', $javascript, $disabled, ' name="', $config_var['name'], '" id="', $config_var['name'], '">', $config_var['value'], '</textarea>';]]></search>
            <add><![CDATA[					echo '
							<textarea rows="', ($config_var['size'] ? $config_var['size'] : 4), '" cols="',($config_var['cols'] ? $config_var['cols'] : 30),'" ', $javascript, $disabled, ' name="', $config_var['name'], '" id="', $config_var['name'], '">', $config_var['value'], '</textarea>';]]></add>
        </operation>
        </file>
        <file name="$themedir/index.template.php">
        <operation>
            <search position="before"><![CDATA[	echo !empty($settings['forum_width']) ? ']]></search>
            <add><![CDATA[	echo $context['tapatalk_body_hook'];]]></add>
        </operation>
        </file>
        <file name="$sourcedir/Subs-Members.php">
        <operation>
            <search position="replace"><![CDATA[		is_not_guest();
		isAllowedTo('moderate_forum');]]></search>
            <add><![CDATA[		if(!defined('mobi_register'))
		{
			is_not_guest();
			isAllowedTo('moderate_forum');
		}]]></add>
        </operation>
        </file>
</modification>