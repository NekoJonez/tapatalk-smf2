<?xml version="1.0"?>
<!DOCTYPE modification SYSTEM "http://www.simplemachines.org/xml/modification">
<modification xmlns="http://www.simplemachines.org/xml/modification" xmlns:smf="http://www.simplemachines.org/">
    <id>TapatalkSMFPlugin:TapatalkDevelopmentTeam</id>
    <file name="$sourcedir/Load.php">
        <operation>
            <search position="after"><![CDATA[	$context['menu_separator'] = !empty($settings['use_image_buttons']) ? ' ' : ' | ';]]></search>
            <add><![CDATA[	$jsfile_name = "tapatalkdetect.js";//(isset($modSettings['tp_tapatalkNotifierForChromeEnabled']) && $modSettings['tp_tapatalkNotifierForChromeEnabled'] && isset($context['browser']['is_chrome']) && $context['browser']['is_chrome'] ) ? "tapatalkdetect.js" :"tapatalkdetect-nochrome.js";
    $context['html_headers'] .= '<script type="text/javascript">
        var tapatalk_iphone_msg = "'.(isset($modSettings['tp_iphone_msg']) ? $modSettings['tp_iphone_msg'] : 'This forum has an app for iPhone and iPod Touch! Click OK to learn more about Tapatalk.') .'";
        var tapatalk_iphone_url = "'.(isset($modSettings['tp_iphone_url']) ? $modSettings['tp_iphone_url'] : 'http://itunes.apple.com/us/app/tapatalk-forum-app/id307880732?mt=8').'";
        var tapatalk_ipad_msg = "'.(isset($modSettings['tp_ipad_msg']) ? $modSettings['tp_ipad_msg'] : 'This forum has an app for iPad! Click OK to learn more about Tapatalk.').'";
        var tapatalk_ipad_url = "'.(isset($modSettings['tp_ipad_url']) ? $modSettings['tp_ipad_url'] : 'http://itunes.apple.com/us/app/tapatalk-hd-for-ipad/id481579541?mt=8').'";
        var tapatalk_kindle_msg = "'.(isset($modSettings['tp_kindle_msg']) ? $modSettings['tp_kindle_msg'] : 'This forum has an app for Kindle Fire! Click OK to learn more about Tapatalk.').'";
        var tapatalk_kindle_url = "'.(isset($modSettings['tp_kindle_url']) ? $modSettings['tp_kindle_url'] : 'http://www.amazon.com/gp/mas/dl/android?p=com.quoord.tapatalkpro.activity').'";
        var tapatalk_android_msg = "'.(isset($modSettings['tp_android_msg']) ? $modSettings['tp_android_msg'] : 'This forum has an app for Android. Click OK to learn more about Tapatalk.').'";
        var tapatalk_android_url = "'.(isset($modSettings['tp_android_url']) ? $modSettings['tp_android_url'] : 'market://details?id=com.quoord.tapatalkpro.activity').'";
        var tapatalk_chrome_enable = '.(isset($modSettings['tp_tapatalkNotifierForChromeEnabled']) && $modSettings['tp_tapatalkNotifierForChromeEnabled'] ? 'true' : 'false').';
        var tapatalkdir = "mobiquo";
    </script>';
	$context['html_headers'] .= '<script type="text/javascript" language="JavaScript" src="' . $boardurl . '/mobiquo/'.$jsfile_name.'"></script>';]]></add>
        </operation>
    </file>
        <file name="$sourcedir/Post.php">
        <operation>
            <search position="replace"><![CDATA[			// Only send it to everyone if the topic is approved, otherwise just to the topic starter if they want it.
			if ($topic_info['approved'])
				sendNotifications($topic, 'reply');]]></search>
            <add><![CDATA[			// Only send it to everyone if the topic is approved, otherwise just to the topic starter if they want it.
			if ($topic_info['approved'])
			{
				sendNotifications($topic, 'reply');
				global $boarddir;
				if (function_exists('tapatalk_push_reply'))
					tapatalk_push_reply($msgOptions['id']);
				else if(file_exists($boarddir . '/mobiquo/push_hook.php'))
				{
					include($boarddir . '/mobiquo/push_hook.php');
					tapatalk_push_reply($msgOptions['id']);
				}
			}]]></add>
        </operation>
        <operation>
            <search position="replace"><![CDATA[			notifyMembersBoard($notifyData);]]></search>
            <add><![CDATA[			notifyMembersBoard($notifyData);
			global $boarddir;
			if (function_exists('tapatalk_push_quote_tag'))
				tapatalk_push_quote_tag($msgOptions['id'], true);
			else if(file_exists($boarddir . '/mobiquo/push_hook.php'))
			{
				include($boarddir . '/mobiquo/push_hook.php');
				tapatalk_push_quote_tag($msgOptions['id'], true);
			}]]></add>
        </operation>
    </file>
        <file name="$sourcedir/PersonalMessage.php">
        <operation>
            <search position="replace"><![CDATA[	// Message sent successfully?
	if (!empty($context['send_log']) && empty($context['send_log']['failed']))
		$context['current_label_redirect'] = $context['current_label_redirect'] . ';done=sent';]]></search>
            <add><![CDATA[	// Message sent successfully?
	if (!empty($context['send_log']) && empty($context['send_log']['failed']))
	{
		$context['current_label_redirect'] = $context['current_label_redirect'] . ';done=sent';
		global $boarddir;
		if (function_exists('tapatalk_push_pm'))
		tapatalk_push_pm();
		else if(file_exists($boarddir . '/mobiquo/push_hook.php'))
		{
			include($boarddir . '/mobiquo/push_hook.php');
			tapatalk_push_pm();
		}
	}]]></add>
        </operation>
    </file>
        </file>

        <file name="$themedir/languages/Admin.english.php">
        <operation>
            <search position="after"><![CDATA[?>]]></search>
            <add><![CDATA[//Tapatalk
$txt['tapatalktitle'] = 'Tapatalk Settings';
$txt['tp_general_settings'] = 'General';
$txt['tp_other_settings'] = 'Others';
$txt['tp_board_settings'] = 'Boards';
$txt['tp_rebranding_settings'] = 'Rebranding Settings';]]></add>
        </operation>
        </file>
        <file name="$themedir/languages/ManageSettings.english.php">
        <operation>
            <search position="after"><![CDATA[?>]]></search>
            <add><![CDATA[//Tapatalk
$txt['tapatalktitle'] = 'Tapatalk Settings';
$txt['tp_pushEnabled'] = 'Enable Tapatalk Push Notification';
$txt['tapatalkEnabled'] = 'Enable tapatalk';
$txt['tp_guestOkayEnabled'] = 'Enable forum view for guest by tapatalk';
$txt['tp_tapatalkNotifierForChromeEnabled'] = 'Enable Tapatalk Notifier in Chrome';
$txt['tp_ipad_msg'] = 'iPad Product Message';
$txt['tp_ipad_url'] = 'iPad Product URL';
$txt['tp_iphone_msg'] = 'iPhone Product Message';
$txt['tp_iphone_url'] = 'iPhone Product URL';
$txt['tp_android_msg'] = 'Android Product Message';
$txt['tp_android_url'] = 'Android Product URL';
$txt['tp_kf_msg'] = 'Kindle Fire Product Message';
$txt['tp_kf_url'] = 'Kindle Fire Product URL';
$txt['tp_allow_usergroup'] = 'Usergroup allowed on Tapatalk';
$txt['tp_general_settings'] = 'General';
$txt['tp_board_settings'] = 'Boards';
$txt['tp_rebranding_settings'] = 'Build Your Own';
$txt['tp_other_settings'] = 'Help';
$txt['tp_parent_board'] = 'Boards1';
$txt['tp_child_board'] = 'Boards2';
$txt['tp_board_settingsDesc'] = 'Settings related to boards';
$txt['tp_general_settingsDesc'] = 'These are general settings for tapatalk';
$txt['tp_other_settingsDesc'] = 'Taptalk information';
$txt['tp_rebranding_settingsDesc'] = 'Settings for users who have built their own mobile forum application, try build your <a href="http://tapatalk.com/build.php"> <u>own application</u></a>?';
$txt['tp_select_boards'] = 'Select Boards to HIDE on Tapatalk';
$txt['tp_disable_newtopic'] = 'Disable New Topic For Boards';
$txt['tp_register_page_url'] = 'Register page url';
$txt['tp_push_key'] = 'Push Notification Key';
$txt['tp_custom_content_replacement'] = 'Thread Content Replacement(Advanced)';
$txt['taptalk_descp'] = '<strong>Tapatalk for SMF Plugin</strong></br><br>
For SMF 2.0 RC5/Final, <a href = "http://www.tapatalk.com">http://www.tapatalk.com</a></br>
For more remote settings, please check <a style="color:red;" href = "http://tapatalk.com/landing.php"><u>here</u></a>.<br><br>
<b>What is Tapatalk?</b></br>
Tapatalk is a forum app for iPhone/iPad, Android, BlackBerry, Windows Phone and WebOS. The app provides super fast forum access to any vBulletin, IPBoard, phpBB, SMF, xenForo, MyBB and Kunena forums that have activated Tapatalk. Forum owner can download the free plug-in to activate Tapatalk in your forum.</br>

<b>What does this mod do?</b></br>
This mod enables your forum to be accessed by the Tapatalk app. The Tapatalk app can be downloaded from Apple iTune Store or from Google Android Market.</br>

<b>What next do I have to do?</b></br>
After installing this mod, head straight to <a href = "http://tapatalk.com/activate_tapatalk.php">http://tapatalk.com/activate_tapatalk.php</a> and register there. After registering you can enlist your forum into the Tapatalk network.</br>
</br>
Please manually change permission of all files under mobiquo/ folder (including the folder itself) to chmod 755 otherwise it won\'t work!!</br>
</br>
For more information please visit tapatalk.com</br>
<br>
Thank you! :)';]]></add>
        </operation>
        </file>

        <file name="$themedir/languages/Help.english.php">
        <operation>
            <search position="after"><![CDATA[?>]]></search>
            <add><![CDATA[//Tapatalk start
$helptxt['tapatalkEnabled'] = 'Enable tapatalk for your forum.';
$helptxt['tp_pushEnabled'] = 'Allows user to receive mobile Push Notification from your forum.';
$helptxt['tp_guestOkayEnabled'] = 'Allow non-registered users to access your forum via Tapatalk.';
$helptxt['tp_tapatalkNotifierForChromeEnabled'] = 'User of your forum using Google Chrome web browser will be notified with the availability of \'Tapatalk Notifier for Chrome\'. Tapatalk Notifier for Chrome is a web browser extension that notify your members with a small alert when he received a new Private Message from your forum. This is a one time alert and is a great tool to keep your users engaged with your forum.';
$helptxt['tp_register_page_url'] = 'Registration URL relative to your forum root path';
$helptxt['tp_push_key'] = 'Optional. To improve the quality of Push Notification from your forum, please fill-in copy and paste the Push Notification Key from Tapatalk Forum Owner Area to here.';
$helptxt['tp_ipad_msg'] = 'Customize this message if you are Tapatalk Rebranding Customer and has published your App to Apple App Store. Default: "This forum has an app for iPad! Click OK to learn more about Tapatalk."';
$helptxt['tp_ipad_url'] = 'Change this URL if you are Tapatalk Rebranding Customer and has obtained your App URL from Apple App Store. Default: http://itunes.apple.com/us/app/tapatalk-hd-for-ipad/id481579541?mt=8';
$helptxt['tp_iphone_msg'] = 'Customize this message if you are Tapatalk Rebranding Customer and has published your App to Apple App Store. Default: "This forum has an app for iPhone and iPod Touch! Click OK to learn more about Tapatalk."';
$helptxt['tp_iphone_url'] = 'Change this URL if you are Tapatalk Rebranding Customer and has obtained your App URL from Apple App Store. Default: http://itunes.apple.com/us/app/tapatalk-forum-app/id307880732?mt=8';
$helptxt['tp_android_msg'] = 'Customize this message if you are Tapatalk Rebranding Customer and has published your App to Google Play. Default: "This forum has an app for Android. Click OK to learn more about Tapatalk."';
$helptxt['tp_android_url'] = 'Change this URL if you are Tapatalk Rebranding Customer and has obtained your App URL from Google Play. Default: market://details?id=com.quoord.tapatalkpro.activity';
$helptxt['tp_kf_msg'] = 'Customize this message if you are Tapatalk Rebranding Customer and has published your App to Amazon App Store. Default: "This forum has an app for Kindle Fire! Click OK to learn more about Tapatalk."';
$helptxt['tp_kf_url'] = 'Change this URL if you are Tapatalk Rebranding Customer and has obtained your App URL from Amazon App Store. Default: http://www.amazon.com/gp/mas/dl/android?p=com.quoord.tapatalkpro.activity';
$helptxt['tp_allow_usergroup'] = 'Allow usergroups to login via Tapatalk, leave this option empty means that all usergroups users can login via Tapatalk. Different usergroups should be departed by comma, for example, "3,11,6" which means only users who belongs to 3,6 and 11 usergroups can login via Tapatalk.';
$helptxt['tp_hide_boards'] = 'Hide forums you don\'t want them to be listed in Tapatalk app.';
$helptxt['tp_dsa_boards'] = 'Prevent Tapatalk users to create new topic in the selected sub-forums. This feature is useful if certain forums requires additional topic fields or permission that Tapatalk does not support.';
$helptxt['tp_custom_content_replacement'] = 'Ability to match and replace thread content using PHP preg_replace function(http://www.php.net/manual/en/function.preg-replace.php). E.g. "\'pattern\', \'replacement\'" . You can define more than one replace rule on each line.';
//Tapatalk ends]]></add>
        </operation>
        </file>

        <file name="$sourcedir/ModerationCenter.php">
        <operation>
            <search position="before"><![CDATA[			'time_started' => timeformat($row['time_started']),
			'last_updated' => timeformat($row['time_updated']),]]></search>
            <add><![CDATA[			'timestamp_started' => $row['time_started'],]]></add>
        </operation>
        </file>
        <file name="$themedir/Who.template.php">
        <operation>
            <search position="replace"><![CDATA[global $context, $settings, $options, $scripturl, $txt;]]></search>
            <add><![CDATA[global $context, $settings, $options, $scripturl, $txt, $boardurl;]]></add>
        </operation>
        <operation>
            <search position="replace"><![CDATA[			echo '
								<span class="contact_info floatright">
									', $context['can_send_pm'] ? '<a href="' . $member['online']['href'] . '" title="' . $member['online']['label'] . '">' : '', $settings['use_image_buttons'] ? '<img src="' . $member['online']['image_href'] . '" alt="' . $member['online']['text'] . '" align="bottom" />' : $member['online']['text'], $context['can_send_pm'] ? '</a>' : '', '
									', isset($context['disabled_fields']['icq']) ? '' : $member['icq']['link'] , ' ', isset($context['disabled_fields']['msn']) ? '' : $member['msn']['link'], ' ', isset($context['disabled_fields']['yim']) ? '' : $member['yim']['link'], ' ', isset($context['disabled_fields']['aim']) ? '' : $member['aim']['link'], '
								</span>';]]></search>
            <add><![CDATA[			echo '
								<span class="contact_info floatright">'.((strpos($member['query']['USER_AGENT'], 'Tapatalk') !== false)? '<a title="On Tapatalk" href="http://tapatalk.com">
<img align="bottom" alt="Online" src="'.$boardurl.'/mobiquo/forum_icons/tapatalk-online.png">
</a>' : ''), $context['can_send_pm'] ? '<a href="' . $member['online']['href'] . '" title="' . $member['online']['label'] . '">' : '', $settings['use_image_buttons'] ? '<img src="' . $member['online']['image_href'] . '" alt="' . $member['online']['text'] . '" align="bottom" />' : $member['online']['text'], $context['can_send_pm'] ? '</a>' : '', '
									', isset($context['disabled_fields']['icq']) ? '' : $member['icq']['link'] , ' ', isset($context['disabled_fields']['msn']) ? '' : $member['msn']['link'], ' ', isset($context['disabled_fields']['yim']) ? '' : $member['yim']['link'], ' ', isset($context['disabled_fields']['aim']) ? '' : $member['aim']['link'], '
								</span>';]]></add>
        </operation>
        </file>
        <file name="$themedir/Admin.template.php">
        <operation>
            <search position="replace"><![CDATA[					echo '
							<textarea rows="', ($config_var['size'] ? $config_var['size'] : 4), '" cols="30" ', $javascript, $disabled, ' name="', $config_var['name'], '" id="', $config_var['name'], '">', $config_var['value'], '</textarea>';]]></search>
            <add><![CDATA[					echo '
							<textarea rows="', ($config_var['size'] ? $config_var['size'] : 4), '" cols="',($config_var['cols'] ? $config_var['cols'] : 30),'" ', $javascript, $disabled, ' name="', $config_var['name'], '" id="', $config_var['name'], '">', $config_var['value'], '</textarea>';]]></add>
        </operation>
        </file>
        <file name="$sourcedir/Subs-Members.php">
        <operation>
            <search position="replace"><![CDATA[		is_not_guest();
		isAllowedTo('moderate_forum');]]></search>
            <add><![CDATA[		if(!defined('mobi_register'))
		{
			is_not_guest();
			isAllowedTo('moderate_forum');
		}]]></add>
        </operation>
        </file>
</modification>